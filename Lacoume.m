
function [S_prime,f] = Lacoume(X,A,e)

[r,N] = size(X);

m40 = sum(X(1,:).^4)/N;
m30 = sum(X(1,:).^3)/N;
m20 = sum(X(1,:).^2)/N;
m10 = sum(X(1,:))/N;
m04 = sum(X(2,:).^4)/N;
m03 = sum(X(2,:).^3)/N;
m02 = sum(X(2,:).^2)/N;
m01 = sum(X(2,:))/N;
m11 = sum(X(1,:).*X(2,:))/N;
m21 = sum((X(1,:).^2).*X(2,:))/N;
m31 = sum((X(1,:).^3).*X(2,:))/N;
m12 = sum(X(1,:).*(X(2,:).^2))/N;
m13 = sum(X(1,:).*(X(2,:).^3))/N;
m22 = sum((X(1,:).^2).*(X(2,:).^2))/N;

A_p = inv(A);
a = A_p(1,2)/A_p(1,1);
b = A_p(2,1)/A_p(2,2);
u = 10^-5;
%
C31 = b*m40 + (3*a*b+1)*m31 + 3*a*(a*b+1)*m22 + (a.^2)*(a*b+3)*m13 + (a.^3)*m04 + (-4*b)*m30*m10 + (-3*b)*m20*m20 + ....
    (-3*a*b-1)*m30*m01 + -3*a*(1+a*b)*m02*m20 + -(a.^2)*(a*b+3)*m10*m03 + -4*(a.^3)*m01*m03 + -3*(a.^3)*m02*m02 + ....
    -3*(3*a*b+1)*m11*m20 + -3*(a^2)*(3+a*b)*m11*m02 + -6*a*(a*b+1)*m11*m11 + -3*(3*a*b+1)*m21*m10 + -6*a*(a*b+1)*m21*m01 + ...
    -3*(a^2)*(a*b+3)*m12*m01 + -6*a*(a*b+1)*m12*m10 + 12*b*m20*(m10^2) + 6*(1+3*a*b)*m20*m10*m01 + 6*a*(a*b+1)*m20*(m01^2) +...
    12*(a^3)*m02*m01*m01 + 6*(a^2)*(3+a*b)*m02*m01*m10 + 6*a*(a*b+1)*m02*m10*m10 + 6*(3*a*b+1)*m11*m10*m10 + ....
    24*a*(a*b+1)*m11*m01*m10 + 6*(a^2)*(3+a*b)*m11*m01*m01 + -6*b*(m10^4) + -6*(1+3*a*b)*(m10^3)*m01 + ...
    -18*a*(1+a*b)*(m10^2)*(m01^2) + -6*(a^2)*(3+a*b)*m10*(m01^3) + -6*(a^3)*(m01^4);

%
C22 = (b^2)*m40 + 2*b*(1+a*b)*m31 + (a*a*b*b+4*a*b+1)*m22 + 2*a*(a*b+1)*m13 + (a^2)*m04 + (-4*b*b)*m30*m10 + ....
    (-3*b*b)*m20*m20 + -2*b*(a*b+1)*m30*m01 + -(a*a*b*b+4*a*b+1)*m02*m20 + -2*a*(a*b+1)*m10*m03 + -4*(a^2)*m01*m03 + ...
    -3*(a^2)*m02*m02 + -6*b*(a*b+1)*m11*m20 + -6*a*(a*b+1)*m11*m02 + -2*(a*a*b*b+4*a*b+1)*m11*m11 + ...
    -6*b*(a*b+1)*m21*m10 + -2*(a*a*b*b+4*a*b+1)*m21*m01 + -6*a*(a*b+1)*m12*m01 +  -2*(a*a*b*b+4*a*b+1)*m12*m10 + ...
    12*b*b*m20*(m10^2) + (12*a*b*b+10*b)*m20*m10*m01 + 2*(a*a*b*b+4*a*b+1)*m20*(m01^2) + 12*(a^2)*m02*m01*m01 + ....
    12*a*(1+a*b)*m02*m01*m10 + 2*(a*a*b*b+4*a*b+1)*m02*m10*m10 + (12*a*b*b+10*b)*m11*m10*m10 + ....
    8*(a*a*b*b+4*a*b+1)*m11*m01*m10 + 12*a*(1+a*b)*m11*m01*m01 + -6*b*b*(m10^4) + -12*b*(1+a*b)*(m10^3)*m01 + ...
    -6*(a*a*b*b+4*a*b+1)*(m10^2)*(m01^2) + -12*a*(1+a*b)*m10*(m01^3) + -6*(a^2)*(m01^4);

%
C13 = (b^3)*m40 + (b^2)*(a*b+3)*m31 + 3*b*(a*b+1)*m22 + (3*a*b+1)*m13 + a*m04 + -4*(b^3)*m30*m10 + -3*(b^3)*m20*m20 + ....
    -(b^2)*(a*b+3)*m30*m01 + -3*b*(1+a*b)*m02*m20 + -(3*a*b+1)*m10*m03 + -4*a*m01*m03 + -3*a*m02*m02 + ....
    -3*(b^2)*(a*b+3)*m11*m20 + -3*(1+3*a*b)*m11*m02 + -6*b*(a*b+1)*m11*m11 + -3*(b^2)*(a*b+3)*m21*m10 + ....
    -6*b*(a*b+1)*m21*m01 + -3*(3*a*b+1)*m12*m01 + -6*b*(a*b+1)*m12*m10 + 12*(b^3)*m20*(m10^2) + ....
    6*(b^2)*(3+a*b)*m20*m10*m01 + 6*b*(a*b+1)*m20*(m01^2) + 12*a*m02*m01*m01 + 6*(1+3*a*b)*m02*m01*m10 + ....
    6*b*(a*b+1)*m02*m10*m10 + 6*(b^2)*(a*b+3)*m11*m10*m10 + 24*b*(a*b+1)*m11*m01*m10 + 6*(1+3*a*b)*m11*m01*m01 + ...
    -6*(b^3)*(m10^4) + -6*(b^2)*(3+a*b)*(m10^3)*m01 + -18*b*(1+a*b)*(m10^2)*(m01^2) + -6*(1+3*a*b)*m10*(m01^3) + ...
    -6*a*(m01^4);

f(1) = 0;
f(2) = 1 / ((C31.^2 + C22.^2 + C13.^2).^0.5);
r = 2;
while (f<e)
    
    diff_a_C31 = 3*b*m31 + 3*(2*a*b+1)*m22 + 3*a*(a*b+2)*m13 + 3*(a^2)*m04 + -3*b*m30*m01 + -3*(1+2*a*b)*m02*m20 + ...
    -3*a*(a*b+2)*m10*m03 + -12*(a^2)*m01*m03 + -9*(a^2)*m02*m02 + -9*b*m11*m20 + -9*a*(2+a*b)*m11*m02 + ...
    -6*(2*a*b+1)*m11*m11 + -9*b*m21*m10 + -6*(2*a*b+1)*m21*m01 + -9*a*(a*b+2)*m12*m01 + -6*(2*a*b+1)*m12*m10 + ...
    18*b*m20*m10*m01 + 6*(2*a*b+1)*m20*(m01^2) + 36*(a^2)*m02*m01*m01 + 18*a*(2+a*b)*m02*m01*m10 + ....
    6*(2*a*b+1)*m02*m10*m10 + 18*b*m11*m10*m10 + 24*(2*a*b+1)*m11*m01*m10 + 18*a*(2+a*b)*m11*m01*m01 + ....
    -18*b*(m10^3)*m01 + -18*(1+2*a*b)*(m10^2)*(m01^2) + -18*a*(2+a*b)*m10*(m01^3) + -18*(a^2)*(m01^4);

    diff_b_C31 =  m40 + 3*a*m31 + 3*a*a*m22 + (a^3)*m13 + -4*m30*m10 + -3*m20*m20 + -3*a*m30*m01 + -3*a*a*m02*m20 + ...
    -(a^3)*m10*m03 + -9*a*m11*m20 + -3*(a^3)*m11*m02 + -6*a*a*m11*m11 + -9*a*m21*m10 + -6*a*a*m21*m01 + ...
    -3*(a^3)*m12*m01 + -6*a*a*m12*m10 + 12*m20*(m10^2) + 18*a*m20*m10*m01 + 6*a*a*m20*(m01^2) + 6*(a^3)*m02*m01*m10 ....
    + 6*a*a*m02*m10*m10 + 18*a*m11*m10*m10 + 24*a*a*m11*m01*m10 + 6*(a^3)*m11*m01*m01 + -6*(m10^4) + -18*a*(m10^3)*m01 + ...
    -18*a*a*(m10^2)*(m01^2) + -6*(a^3)*m10*(m01^3);

    diff_a_C22 = 2*b*b*m31 + (a*b*2*b+4*b)*m22 + 2*(2*a*b+1)*m13 + 2*a*m04 + -2*b*b*m30*m01 + -(2*a*b*b+4*b)*m02*m20 + ...
    -2*(2*a*b+1)*m10*m03 + -8*a*m01*m03 + -6*a*m02*m02 + -6*b*b*m11*m20 + -6*(2*a*b+1)*m11*m02 + ....
    -2*(2*a*b*b+4*b)*m11*m11 + -6*b*b*m21*m10 + -2*(2*a*b*b+4*b)*m21*m01 + -6*(2*a*b+1)*m12*m01 + ....
    -2*(2*a*b*b+4*b)*m12*m10 + (12*b*b)*m20*m10*m01 + 2*(2*a*b*b+4*b)*m20*(m01^2) + 24*a*m02*m01*m01 + ....
    12*(1+2*a*b)*m02*m01*m10 + 2*(2*a*b*b+4*b)*m02*m10*m10 + (12*b*b)*m11*m10*m10 + 8*(2*a*b*b+4*b)*m11*m01*m10 + ....
    12*(1+2*a*b)*m11*m01*m01 + -12*b*b*(m10^3)*m01 + -6*(2*a*b*b+4*b)*(m10^2)*(m01^2) + -12*(1+2*a*b)*m10*(m01^3) + ...
    -12*a*(m01^4);

    diff_b_C22 = 2*b*m40 + 2*(1+2*a*b)*m31 + (a*a*2*b+4*a)*m22 + 2*a*a*m13 + -8*b*m30*m10 + -6*b*m20*m20 + ....
    -2*(2*a*b+1)*m30*m01 + -(a*a*2*b+4*a)*m02*m20 + -2*a*a*m10*m03 + -6*(2*a*b+1)*m11*m20 + -6*a*a*m11*m02 + ...
    -2*(a*a*2*b+4*a)*m11*m11 + -6*(2*a*b+1)*m21*m10 + -2*(a*a*2*b+4*a)*m21*m01 + -6*a*a*m12*m01 + ...
    -2*(a*a*2*b+4*a)*m12*m10 + 24*b*m20*(m10^2) + (12*a*2*b+10)*m20*m10*m01 + 2*(a*a*2*b+4*a)*m20*(m01^2) + ....
    12*a*a*m02*m01*m10 + 2*(a*a*2*b+4*a)*m02*m10*m10 + (12*a*2*b+10)*m11*m10*m10 + 8*(a*a*2*b+4*a)*m11*m01*m10 + ...
    12*a*a*m11*m01*m01 + -12*b*(m10^4) + -12*(1+2*a*b)*(m10^3)*m01 + -6*(a*a*2*b+4*a)*(m10^2)*(m01^2) + -12*a*a*m10*(m01^3);

    diff_a_C13 = (b^3)*m31 + 3*b*b*m22 + 3*b*m13 + m04 + -(b^3)*m30*m01 + -3*b*b*m02*m20 + -3*b*m10*m03 + ....
    -4*m01*m03 + -3*m02*m02 + -3*(b^3)*m11*m20 + -9*b*m11*m02 + -6*b*b*m11*m11 + -3*(b^3)*m21*m10 + ....
    -6*b*b*m21*m01 + -9*b*m12*m01 + -6*b*b*m12*m10 + 6*(b^3)*m20*m10*m01 + 6*b*b*m20*(m01^2) + 12*m02*m01*m01 + ...
    18*b*m02*m01*m10 + 6*b*b*m02*m10*m10 + 6*(b^3)*m11*m10*m10 + 24*b*b*m11*m01*m10 + 18*b*m11*m01*m01 + ...
    -6*(b^3)*(m10^3)*m01 + -18*b*b*(m10^2)*(m01^2) + -18*b*m10*(m01^3) + -6*(m01^4);

    diff_b_C13 = 3*(b^2)*m40 + 3*b*(a*b+2)*m31 + 3*(2*a*b+1)*m22 + 3*a*m13 + -12*(b^2)*m30*m10 + -9*(b^2)*m20*m20 + ....
    -3*b*(a*b+2)*m30*m01 + -3*(1+2*a*b)*m02*m20 + -3*a*m10*m03 + -9*b*(a*b+2)*m11*m20 + -9*a*m11*m02 + ....
    -6*(2*a*b+1)*m11*m11 + -9*b*(a*b+2)*m21*m10 + -6*(2*a*b+1)*m21*m01 + -9*a*m12*m01 + -6*(2*a*b+1)*m12*m10 + ....
    36*(b^2)*m20*(m10^2) + 18*b*(2+a*b)*m20*m10*m01 + 6*(2*a*b+1)*m20*(m01^2) + 18*a*m02*m01*m10 + ....
    6*(2*a*b+1)*m02*m10*m10 + 18*b*(a*b+2)*m11*m10*m10 + 24*(2*a*b+1)*m11*m01*m10 + 18*a*m11*m01*m01 + -18*(b^2)*(m10^4) + ...
    -18*b*(2+a*b)*(m10^3)*m01 + -18*(1+2*a*b)*(m10^2)*(m01^2) + -18*a*m10*(m01^3);

    Df_a = -(C31*diff_a_C31 + C22*diff_a_C22 + C13*diff_a_C13)*(f(r).^3);
    Df_b = -(C31*diff_b_C31 + C22*diff_b_C22 + C13*diff_b_C13)*(f(r).^3);
    a = a + Df_a.*u;
    b = b + Df_b.*u;
    
    %
C31 = b*m40 + (3*a*b+1)*m31 + 3*a*(a*b+1)*m22 + (a.^2)*(a*b+3)*m13 + (a.^3)*m04 + (-4*b)*m30*m10 + (-3*b)*m20*m20 + ....
    (-3*a*b-1)*m30*m01 + -3*a*(1+a*b)*m02*m20 + -(a.^2)*(a*b+3)*m10*m03 + -4*(a.^3)*m01*m03 + -3*(a.^3)*m02*m02 + ....
    -3*(3*a*b+1)*m11*m20 + -3*(a^2)*(3+a*b)*m11*m02 + -6*a*(a*b+1)*m11*m11 + -3*(3*a*b+1)*m21*m10 + -6*a*(a*b+1)*m21*m01 + ...
    -3*(a^2)*(a*b+3)*m12*m01 + -6*a*(a*b+1)*m12*m10 + 12*b*m20*(m10^2) + 6*(1+3*a*b)*m20*m10*m01 + 6*a*(a*b+1)*m20*(m01^2) +...
    12*(a^3)*m02*m01*m01 + 6*(a^2)*(3+a*b)*m02*m01*m10 + 6*a*(a*b+1)*m02*m10*m10 + 6*(3*a*b+1)*m11*m10*m10 + ....
    24*a*(a*b+1)*m11*m01*m10 + 6*(a^2)*(3+a*b)*m11*m01*m01 + -6*b*(m10^4) + -6*(1+3*a*b)*(m10^3)*m01 + ...
    -18*a*(1+a*b)*(m10^2)*(m01^2) + -6*(a^2)*(3+a*b)*m10*(m01^3) + -6*(a^3)*(m01^4);

%
C22 = (b^2)*m40 + 2*b*(1+a*b)*m31 + (a*a*b*b+4*a*b+1)*m22 + 2*a*(a*b+1)*m13 + (a^2)*m04 + (-4*b*b)*m30*m10 + ....
    (-3*b*b)*m20*m20 + -2*b*(a*b+1)*m30*m01 + -(a*a*b*b+4*a*b+1)*m02*m20 + -2*a*(a*b+1)*m10*m03 + -4*(a^2)*m01*m03 + ...
    -3*(a^2)*m02*m02 + -6*b*(a*b+1)*m11*m20 + -6*a*(a*b+1)*m11*m02 + -2*(a*a*b*b+4*a*b+1)*m11*m11 + ...
    -6*b*(a*b+1)*m21*m10 + -2*(a*a*b*b+4*a*b+1)*m21*m01 + -6*a*(a*b+1)*m12*m01 +  -2*(a*a*b*b+4*a*b+1)*m12*m10 + ...
    12*b*b*m20*(m10^2) + (12*a*b*b+10*b)*m20*m10*m01 + 2*(a*a*b*b+4*a*b+1)*m20*(m01^2) + 12*(a^2)*m02*m01*m01 + ....
    12*a*(1+a*b)*m02*m01*m10 + 2*(a*a*b*b+4*a*b+1)*m02*m10*m10 + (12*a*b*b+10*b)*m11*m10*m10 + ....
    8*(a*a*b*b+4*a*b+1)*m11*m01*m10 + 12*a*(1+a*b)*m11*m01*m01 + -6*b*b*(m10^4) + -12*b*(1+a*b)*(m10^3)*m01 + ...
    -6*(a*a*b*b+4*a*b+1)*(m10^2)*(m01^2) + -12*a*(1+a*b)*m10*(m01^3) + -6*(a^2)*(m01^4);

%
C13 = (b^3)*m40 + (b^2)*(a*b+3)*m31 + 3*b*(a*b+1)*m22 + (3*a*b+1)*m13 + a*m04 + -4*(b^3)*m30*m10 + -3*(b^3)*m20*m20 + ....
    -(b^2)*(a*b+3)*m30*m01 + -3*b*(1+a*b)*m02*m20 + -(3*a*b+1)*m10*m03 + -4*a*m01*m03 + -3*a*m02*m02 + ....
    -3*(b^2)*(a*b+3)*m11*m20 + -3*(1+3*a*b)*m11*m02 + -6*b*(a*b+1)*m11*m11 + -3*(b^2)*(a*b+3)*m21*m10 + ....
    -6*b*(a*b+1)*m21*m01 + -3*(3*a*b+1)*m12*m01 + -6*b*(a*b+1)*m12*m10 + 12*(b^3)*m20*(m10^2) + ....
    6*(b^2)*(3+a*b)*m20*m10*m01 + 6*b*(a*b+1)*m20*(m01^2) + 12*a*m02*m01*m01 + 6*(1+3*a*b)*m02*m01*m10 + ....
    6*b*(a*b+1)*m02*m10*m10 + 6*(b^2)*(a*b+3)*m11*m10*m10 + 24*b*(a*b+1)*m11*m01*m10 + 6*(1+3*a*b)*m11*m01*m01 + ...
    -6*(b^3)*(m10^4) + -6*(b^2)*(3+a*b)*(m10^3)*m01 + -18*b*(1+a*b)*(m10^2)*(m01^2) + -6*(1+3*a*b)*m10*(m01^3) + ...
    -6*a*(m01^4);
    
    r = r+1;
    f(r) = 1 ./ ((C31.^2 + C22.^2 + C13.^2).^0.5);

end


B = [1 a
     b 1];
 S_prime = B*X;
 
end
     